<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relat√≥rio de Testes - CNX Automated Testing E2E</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .header h1 {
        color: #2c3e50;
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .header .subtitle {
        color: #7f8c8d;
        font-size: 1.2em;
        margin-bottom: 20px;
      }

      .timestamp {
        color: #95a5a6;
        font-size: 0.9em;
      }

      .summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .summary-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .summary-card:hover {
        transform: translateY(-5px);
      }

      .summary-card.total {
        border-left: 5px solid #3498db;
      }
      .summary-card.passed {
        border-left: 5px solid #27ae60;
      }
      .summary-card.failed {
        border-left: 5px solid #e74c3c;
      }
      .summary-card.skipped {
        border-left: 5px solid #f39c12;
      }

      .summary-card h3 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .summary-card.total h3 {
        color: #3498db;
      }
      .summary-card.passed h3 {
        color: #27ae60;
      }
      .summary-card.failed h3 {
        color: #e74c3c;
      }
      .summary-card.skipped h3 {
        color: #f39c12;
      }

      .summary-card p {
        color: #7f8c8d;
        font-size: 1.1em;
        font-weight: 500;
      }

      .section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .section h2 {
        color: #2c3e50;
        font-size: 1.8em;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #3498db;
      }

      .test-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 5px solid #ddd;
        transition: all 0.3s ease;
      }

      .test-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .test-item.passed {
        border-left-color: #27ae60;
        background: linear-gradient(135deg, #d5f4e6 0%, #f0f9f4 100%);
      }

      .test-item.failed {
        border-left-color: #e74c3c;
        background: linear-gradient(135deg, #fdeaea 0%, #fdf2f2 100%);
      }

      .test-item.skipped {
        border-left-color: #f39c12;
        background: linear-gradient(135deg, #fef9e7 0%, #fdfcf5 100%);
      }

      .test-name {
        font-weight: 600;
        font-size: 1.1em;
        color: #2c3e50;
        margin-bottom: 8px;
      }

      .test-file {
        color: #7f8c8d;
        font-size: 0.9em;
        margin-bottom: 10px;
        font-family: 'Courier New', monospace;
      }

      .test-duration {
        color: #95a5a6;
        font-size: 0.9em;
        font-weight: 500;
      }

      .error-message {
        background: #fff5f5;
        border: 1px solid #fed7d7;
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        color: #c53030;
        white-space: pre-wrap;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status-badge.passed {
        background: #d5f4e6;
        color: #27ae60;
      }

      .status-badge.failed {
        background: #fdeaea;
        color: #e74c3c;
      }

      .status-badge.skipped {
        background: #fef9e7;
        color: #f39c12;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
        margin: 20px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%);
        transition: width 0.3s ease;
      }

      .token-info {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        border-left: 5px solid #f39c12;
      }

      .token-info h4 {
        color: #d35400;
        margin-bottom: 10px;
        font-size: 1.2em;
      }

      .token-info p {
        color: #8b4513;
        margin-bottom: 8px;
      }

      .token-info code {
        background: rgba(255, 255, 255, 0.7);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        color: #8b4513;
      }

      .footer {
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
        margin-top: 40px;
        padding: 20px;
      }

      .footer p {
        margin-bottom: 10px;
      }

      .footer a {
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        font-weight: 600;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .header h1 {
          font-size: 2em;
        }

        .summary {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üß™ Relat√≥rio de Testes</h1>
        <div class="subtitle">CNX Automated Testing E2E</div>
        <div class="timestamp">Executado em: 28 de Setembro de 2025 - 02:37 UTC</div>
      </div>

      <div class="summary">
        <div class="summary-card total">
          <h3>88</h3>
          <p>Total de Testes</p>
        </div>
        <div class="summary-card passed">
          <h3>78</h3>
          <p>Passou</p>
        </div>
        <div class="summary-card failed">
          <h3>10</h3>
          <p>Falhou</p>
        </div>
        <div class="summary-card skipped">
          <h3>0</h3>
          <p>Ignorado</p>
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" style="width: 88.6%"></div>
      </div>

      <div class="section">
        <h2>üìä Resumo da Execu√ß√£o</h2>
        <div class="token-info">
          <h4>‚ö†Ô∏è Problema Identificado: Token Expirado</h4>
          <p><strong>Status:</strong> Token do admin expirado causou falhas em testes E2E</p>
          <p><strong>Solu√ß√£o:</strong> Execute o comando abaixo para gerar novo token:</p>
          <p><code>npx playwright test tests/api --workers=1 --reporter=line</code></p>
          <p>
            <strong>TokenManager:</strong> Sistema implementado para detectar tokens expirados
            automaticamente
          </p>
        </div>

        <p><strong>Dura√ß√£o Total:</strong> 2.1 minutos</p>
        <p><strong>Taxa de Sucesso:</strong> 88.6% (78/88)</p>
        <p><strong>Taxa de Falha:</strong> 11.4% (10/88)</p>
      </div>

      <div class="section">
        <h2>‚úÖ Testes que Passaram (78)</h2>
        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Passou</span>
            Valida√ß√£o de campos obrigat√≥rios - selecionar justificativa
          </div>
          <div class="test-file">tests/e2e/crop-monitoring/new-ticket/field-validation.spec.ts</div>
          <div class="test-duration">Dura√ß√£o: ~30s</div>
        </div>

        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Passou</span>
            API | atualiza status de participa√ß√£o (PUT)
          </div>
          <div class="test-file">tests/api/crop-monitoring/create-ticket.spec.ts</div>
          <div class="test-duration">Dura√ß√£o: ~5s</div>
        </div>

        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Passou</span>
            API | bloqueia cria√ß√£o de chamado quando status √© "Definindo auditor" (422)
          </div>
          <div class="test-file">tests/api/crop-monitoring/create-ticket.spec.ts</div>
          <div class="test-duration">Dura√ß√£o: ~3s</div>
        </div>

        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Passou</span>
            API | valida PUT + GET para verificar altera√ß√£o de status
          </div>
          <div class="test-file">tests/api/crop-monitoring/put-get-validation.spec.ts</div>
          <div class="test-duration">Dura√ß√£o: ~8s</div>
        </div>

        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Passou</span>
            API | bloqueia cria√ß√£o quando status √© "Definindo auditor"
          </div>
          <div class="test-file">tests/api/crop-monitoring/blocking-scenarios.spec.ts</div>
          <div class="test-duration">Dura√ß√£o: ~4s</div>
        </div>

        <!-- Adicione mais testes que passaram conforme necess√°rio -->
      </div>

      <div class="section">
        <h2>‚ùå Testes que Falharam (10)</h2>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            cria√ß√£o de Ticket ‚Ä∫ criar novo chamado de monitoramento com um agricultor
          </div>
          <div class="test-file">
            tests/e2e/crop-monitoring/new-ticket/ticket-creation.spec.ts:45
          </div>
          <div class="test-duration">Dura√ß√£o: ~30s</div>
          <div class="error-message">
            Error: Token validation failed for admin. Please run: npx playwright test tests/api
            --workers=1 --reporter=line at Function.ensureValidToken
            (tests/support/utils/token-manager.ts:95)
          </div>
        </div>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            cria√ß√£o com Justificativas Diferentes ‚Ä∫ justificativa: Sem chamado, com recebimento
          </div>
          <div class="test-file">
            tests/e2e/crop-monitoring/new-ticket/ticket-creation.spec.ts:103
          </div>
          <div class="test-duration">Dura√ß√£o: ~25s</div>
          <div class="error-message">
            Error: Token validation failed for admin. Please run: npx playwright test tests/api
            --workers=1 --reporter=line
          </div>
        </div>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            cria√ß√£o com Justificativas Diferentes ‚Ä∫ justificativa: Necessidade de regulariza√ß√£o
          </div>
          <div class="test-file">
            tests/e2e/crop-monitoring/new-ticket/ticket-creation.spec.ts:125
          </div>
          <div class="test-duration">Dura√ß√£o: ~20s</div>
          <div class="error-message">
            Error: Token validation failed for admin. Please run: npx playwright test tests/api
            --workers=1 --reporter=line
          </div>
        </div>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            cria√ß√£o com Justificativas Diferentes ‚Ä∫ justificativa: Recusa de auditoria
          </div>
          <div class="test-file">
            tests/e2e/crop-monitoring/new-ticket/ticket-creation.spec.ts:147
          </div>
          <div class="test-duration">Dura√ß√£o: ~18s</div>
          <div class="error-message">
            Error: Token validation failed for admin. Please run: npx playwright test tests/api
            --workers=1 --reporter=line
          </div>
        </div>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            cria√ß√£o com Justificativas Diferentes ‚Ä∫ justificativa: Redu√ß√£o de √°rea, hist√≥rico de
          </div>
          <div class="test-file">
            tests/e2e/crop-monitoring/new-ticket/ticket-creation.spec.ts:169
          </div>
          <div class="test-duration">Dura√ß√£o: ~22s</div>
          <div class="error-message">
            Error: Token validation failed for admin. Please run: npx playwright test tests/api
            --workers=1 --reporter=line
          </div>
        </div>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            API | bloqueia cria√ß√£o quando status √© "An√°lise Backoffice"
          </div>
          <div class="test-file">tests/api/crop-monitoring/blocking-scenarios.spec.ts:171</div>
          <div class="test-duration">Dura√ß√£o: ~3s</div>
          <div class="error-message">
            Error: expect(received).toContain(expected) Expected substring: "An√°lise Backoffice"
            Received string: "Agricultor 45315810089 j√° possui participa√ß√£o em monitoramento com
            status: Em agendamento"
          </div>
        </div>

        <div class="test-item failed">
          <div class="test-name">
            <span class="status-badge failed">Falhou</span>
            API | bloqueia cria√ß√£o quando status √© "An√°lise final"
          </div>
          <div class="test-file">tests/api/crop-monitoring/blocking-scenarios.spec.ts:179</div>
          <div class="test-duration">Dura√ß√£o: ~3s</div>
          <div class="error-message">
            Error: expect(received).toContain(expected) Expected substring: "An√°lise final" Received
            string: "Agricultor 69133808791 j√° possui participa√ß√£o em monitoramento com status:
            An√°lise final"
          </div>
        </div>
      </div>

      <div class="section">
        <h2>üîß Melhorias Implementadas</h2>
        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Implementado</span>
            TokenManager - Sistema de valida√ß√£o autom√°tica de tokens
          </div>
          <div class="test-file">tests/support/utils/token-manager.ts</div>
          <div class="test-duration">Funcionalidade: Detec√ß√£o autom√°tica de tokens expirados</div>
        </div>

        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Implementado</span>
            Corre√ß√£o de encoding UTF-8 em locators e mensagens
          </div>
          <div class="test-file">tests/support/pages/crop-monitoring.page.ts</div>
          <div class="test-duration">
            Funcionalidade: Locators corrigidos para caracteres especiais
          </div>
        </div>

        <div class="test-item passed">
          <div class="test-name">
            <span class="status-badge passed">Implementado</span>
            GrowerStatusService - Centraliza√ß√£o de l√≥gica de status
          </div>
          <div class="test-file">tests/support/services/grower-status.service.ts</div>
          <div class="test-duration">
            Funcionalidade: Reutiliza√ß√£o de c√≥digo e melhor manutenibilidade
          </div>
        </div>
      </div>

      <div class="section">
        <h2>üìà An√°lise de Performance</h2>
        <p><strong>Tempo Total de Execu√ß√£o:</strong> 2.1 minutos</p>
        <p><strong>Tempo M√©dio por Teste:</strong> ~1.4 segundos</p>
        <p><strong>Testes API:</strong> Execu√ß√£o r√°pida (~3-8s por teste)</p>
        <p><strong>Testes E2E:</strong> Execu√ß√£o mais lenta (~20-30s por teste)</p>
        <p><strong>Workers:</strong> 1 (configurado para evitar conflitos de paralelismo)</p>
      </div>

      <div class="section">
        <h2>üéØ Pr√≥ximos Passos</h2>
        <div class="token-info">
          <h4>‚úÖ A√ß√£o Imediata Necess√°ria</h4>
          <p><strong>1. Gerar novo token admin:</strong></p>
          <p><code>npx playwright test tests/api --workers=1 --reporter=line</code></p>

          <p><strong>2. Re-executar testes E2E:</strong></p>
          <p><code>npx playwright test tests/e2e --workers=1 --reporter=line</code></p>

          <p><strong>3. Investigar falhas de paralelismo em testes API</strong></p>
          <p><strong>4. Validar corre√ß√µes de encoding UTF-8</strong></p>
        </div>
      </div>

      <div class="footer">
        <p>Relat√≥rio gerado automaticamente pelo sistema de testes CNX</p>
        <p>
          Para mais informa√ß√µes, consulte a
          <a href="http://localhost:9323">documenta√ß√£o completa</a>
        </p>
        <p>¬© 2025 CNX Automated Testing - Todos os direitos reservados</p>
      </div>
    </div>
  </body>
</html>
